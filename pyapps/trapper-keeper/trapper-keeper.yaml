# yaml-language-server: $schema=https://taskfile.dev/schema.json
version: "3"

tasks:
  init:
    desc: "Initialize Trapper Keeper"
    sources:
      - pyproject.toml
    generates:
      - poetry.lock
    cmds:
      - poetry install

  build:
    internal: true
    silent: true
    run: once
    deps:
      - init
    desc: "Build Trapper Keeper"
    cmds:
      - nx build @technohouser/apps/trapper-keeper
    sources:
      - trapper-keeper/trapper_keeper/**/*.py

  update:
    desc: "Update Trapper Keeper Dependencies"
    cmds:
      - nx update trapper-keeper

  install:
    internal: true
    silent: true
    deps:
      - build
    desc: "Install Trapper Keeper"
    cmds:
      - nx install @technohouser/apps/trapper-keeper
    sources:
      - trapper-keeper/trapper_keeper/**/*.py
    generates:
      - "{{.XDG_BIN_HOME}}/pipx/bin/trapper_keeper"

  deploy:
    internal: true
    silent: true
    run: once
    deps:
      - build
    desc: "Deploy Trapper Keeper"
    cmds:
      - pipx install . --force --include-deps
    sources:
      - dist/*.whl
    generates:
      - "{{.XDG_BIN_HOME}}/pipx/bin/trapper_keeper"

  run:
    desc: "Run Trapper Keeper Command"
    summary: |

    deps:
      - install
    cmds:
      - poetry run python -m trapper_keeper {{.CLI_ARGS}}

